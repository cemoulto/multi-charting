   <DOCTYPE !html>
<html>
    <head>

        <script type='text/javascript' src='../../node_modules/fusioncharts/fusioncharts.js'></script>
        <script type='text/javascript' src='../../node_modules/fusioncharts/fusioncharts.timeseries.js'></script>
        <script type='text/javascript' src='../../out/fusioncharts.multicharting.js'></script>
        <script type='text/javascript' src='../../node_modules/fusioncharts/themes/fusioncharts.theme.ocean.js'></script>
        <script type='text/javascript' src='data.js'></script>

    </head>

    <body>

        <center style='margin: 10px'>
            <div id="matrix">
                <progress id="progress" value="0"></progress>
            </div>
        </center>

        <style type="text/css">
            #matrix div {
                border: 1px solid #CCCCCC;
                vertical-align: middle;
            }
        
        </style>

        <script type='text/javascript'>

            var MultiChartObj = new MultiCharting(),
                dataStore = MultiChartObj.createDataStore(),
                dataStore2 = MultiChartObj.createDataStore(),
                progressBar = document.getElementById('progress'),
                sortOperator = function (a, b) {
                    return Number(a.Sales) - Number(b.Sales);
                },
                filterOperator = function (a, b) {
                    return Number(a.Sales) > 15000;
                };

            // Attach event to show Ajax file load progress bar
            MultiChartObj.addEventListener('onprogress', function(e, a) {
                a = a.Event;
                // progressBar.max = a.total;
                // progressBar.value = a.loaded;
                console.log('Loading file: ', Math.round(100 * a.loaded / a.total), '%');
            });


            dataStore.setData({
                dataType: 'json',
                dataSource: dataArr
            }, function () {
                
                sortProcessor = MultiChartObj.createDataProcessor();
                sortProcessor.sort(sortOperator);
                
                filterProcessor = MultiChartObj.createDataProcessor();
                filterProcessor.filter(filterOperator);

                sortedData = dataStore.getChildModel(sortProcessor);
                filtereddData = dataStore.getChildModel(filterProcessor);
                
                fcData = MultiChartObj.dataAdapter(dataStore, {
                    dimension: ['Year'],
                    measure: ['Sales'],
                    seriesType: 'SS'
                });

                console.log(JSON.stringify(fcData._getFCjson(), null, 2));
                // console.log(JSON.stringify(filtereddData.getJSON(), null, 2));
                // console.log(JSON.stringify(dataStore.getJSON(), null, 2));
                // console.log(JSON.stringify(sortedData.getJSON()));

            });










            dataStore2.setDataUrl({
                dataType: 'csv',
                dataSource: '../data.csv?adfd=' + Math.random()
            }, function () {
                
            });



            // var xhr = new XMLHttpRequest();

            // xhr.open("GET", "../thads2011.csv?" + Math.floor(Math.random() * 99999), true);
            // xhr.responseType = "json";

            // xhr.onprogress = function(e) {
            //     if (e.lengthComputable) {
            //         progressBar.max = e.total;
            //         progressBar.value = e.loaded;
            //     }
            // };
            
            // xhr.onloadstart = function(e) {
            //     progressBar.value = 0;
            // };
            
            // xhr.onloadend = function(e) {
            //     progressBar.value = e.loaded;
            // };

            // xhr.send(null);


        </script>

    </body>


</html>
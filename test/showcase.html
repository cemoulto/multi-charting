   <DOCTYPE !html>
<html>
    <head>

<!--
        <script type='text/javascript' src='../src/fusioncharts.multicharting.js'></script>
        <script type='text/javascript' src='../src/multicharting.lib.js'></script>
        <script type='text/javascript' src='../src/multicharting.datastore.js'></script>
        <script type='text/javascript' src='../src/multicharting.dataprocessor.js'></script>
        <script type='text/javascript' src='../src/multicharting.dataadapter.js'></script>
        <script type="text/javascript" src="../src/multicharting.createchart.js"></script>
        <script type="text/javascript" src="../src/multicharting.matrix.js"></script>
        Improved the arguments for csv data manager Added gulp-rename dependency
 -->

        <script type='text/javascript' src='../out/fusioncharts.multicharting.js'></script>
        <script type='text/javascript' src='../node_modules/fusioncharts/fusioncharts.js'></script>
        <script type='text/javascript' src='../node_modules/fusioncharts/themes/fusioncharts.theme.ocean.js'></script>

    </head>

    <body>

        <center style='margin: 10px'>
            <div id="matrix"></div>
        </center>

        <style type="text/css">
            #matrix {
                width: 750px;
                position: relative;
                display: inline-block;
            }
            #matrix div {
                border: 1px solid #CCCCCC;
                vertical-align: middle;
            }
        </style>

        <script type='text/javascript'>
            var MultiChartObj = new MultiCharting(),
            	dataStore,
            	dataProcessor1,
            	dataProcessor2,
            	data,
            	sortOperator,
            	filterOperator,
            	newData1,
            	newData2;

            dataStore = MultiChartObj.createDataStore();

            function parseDate(d) {
                  return new Date(2001,
                        d.substring(0, 2) - 1,
                        d.substring(2, 4),
                        d.substring(4, 6),
                        d.substring(6, 8));
            }


			MultiChartObj.ajax({
                        // url: 'airline-small.csv', 
				url: 'airline.csv', 
				success: function (dataCSV) {
					MultiChartObj.convertToArray({
						string: dataCSV,
                                    structure: 2,
						callback: function (data) {
      						// Store the data
      				            dataStore.setData({
      				            	dataSource: data
      				            }, function () {

                                                var filterByDate = function (data) {
                                                      var flights = {
                                                      },
                                                      dataArr = [['Date', 'Flights']],
                                                      i;
                                                      data.forEach(function (row) {
                                                            if (!flights[row.fulldate]) {
                                                                  flights[row.fulldate] = 0;
                                                            }
                                                            flights[row.fulldate] += 1;
                                                      });
                                                      for (var i in flights) {
                                                          dataArr.push([i, flights[i]]);
                                                      }
                                                      return dataArr;
                                                },
                                                filterByTime = function (data) {
                                                      var flights = {
                                                      },
                                                      dataArr = [['Time', 'Flights']],
                                                      i;
                                                      debugger;
                                                      data.forEach(function (row) {
                                                            if (!flights[row.time]) {
                                                                  flights[row.time] = 0;
                                                            }
                                                            flights[row.time] += 1;
                                                      });
                                                      for (var i in flights) {
                                                          dataArr.push([i, flights[i]]);
                                                      }
                                                      return dataArr;
                                                },
                                                filterByArrival = function (data) {
                                                      var flights = {
                                                      },
                                                      dataArr = [['Arrival', 'Flights']],
                                                      i;
                                                      data.forEach(function (row) {
                                                            if (!flights[row.delay]) {
                                                                  flights[row.delay] = 0;
                                                            }
                                                            flights[row.delay] += 1;
                                                      });
                                                      for (var i in flights) {
                                                          dataArr.push([i, flights[i]]);
                                                      }
                                                      return dataArr;
                                                },
                                                filterByDistance = function (data) {
                                                      var flights = {
                                                      },
                                                      dataArr = [['Date', 'Flights']],
                                                      i,
                                                      c;
                                                      for (i = 0, c = 0; i <= 2000; i += 50, c++) {
                                                          // flights[c] = {v: i};
                                                      }
                                                      data.forEach(function (row) {
                                                            if (!flights[row.distance]) {
                                                                  flights[row.distance] = 0;
                                                            }
                                                            flights[row.distance] += 1;
                                                      });
                                                      for (var i in flights) {
                                                          dataArr.push([i, flights[i]]);
                                                      }
                                                      return dataArr;
                                                },
                                                mapFilter = function (row, i) {
                                                      d = parseDate(row.date);
                                                      row.fulldate = d.getMonth() + '-' + d.getDate() + '-' + d.getFullYear();
                                                      row.time = d.getHours();
                                                      return row;
                                                };

                                                // Parse the date and add information in the data
                                                map = MultiChartObj.createDataProcessor();
                                                map.map(mapFilter);
                                                newData = dataStore.getData(map);

                                                // filter number of flights by date
                                                dateDataProcessor = MultiChartObj.createDataProcessor();
                                                dateDataProcessor.addRule({rule: filterByDate});
                                                flightByDate = dataStore.getData(dateDataProcessor);

                                                // filter number of flights by time of day
                                                timeDataProcessor = MultiChartObj.createDataProcessor();
                                                timeDataProcessor.addRule({rule: filterByTime});
                                                flightByTime = dataStore.getData(timeDataProcessor);
                                                
                                                
                                                // filter number of flights by arrival delay (min)
                                                arrivalDataProcessor = MultiChartObj.createDataProcessor();
                                                arrivalDataProcessor.addRule({rule: filterByArrival});
                                                flightByArrival = dataStore.getData(arrivalDataProcessor);

                                                // filter number of flights by distance
                                                distanceDataProcessor = MultiChartObj.createDataProcessor();
                                                distanceDataProcessor.addRule({rule: filterByDistance});
                                                flightByDistance = dataStore.getData(distanceDataProcessor);

                                                window.dt = flightByDate.getJSON();
                                                window.t = flightByTime.getJSON();
                                                window.a = flightByArrival.getJSON();
                                                window.di = flightByDistance.getJSON();

                                                console.log('done');

                                          });
						}
					})
				}
			});

        </script>

    </body>


</html>